<!-- Main -->
<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">
    <div
        class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between sm:px-3   bg-card dark:bg-transparent">
        <!-- Title -->

        <div class="flex flex-col w-full sm:items-center sm:justify-between p-3 sm:px-10 bg-card dark:bg-transparent">
            <div class="flex flex-row min-w-0 w-full">
                <!-- Breadcrumbs -->
                <div class="flex flex-col items-center font-medium w-1/2">
                    <div class="flex flex-row items-center font-medium w-full">
                        <div>
                            <a>Sales</a>
                        </div>
                        <div class="flex items-center ml-1 whitespace-nowrap">
                            <mat-icon class="icon-size-5 text-secondary" [svgIcon]="'heroicons_solid:chevron-right'">
                            </mat-icon>
                            <a [routerLink]="['..']" style="cursor: pointer;"
                                class="whitespace-nowrap text-primary-500">Documents</a>
                            <mat-icon class="icon-size-5 text-secondary" [svgIcon]="'heroicons_solid:chevron-right'">
                            </mat-icon>
                            <a>Payment Adjustment</a>
                        </div>
                    </div>
                    <div
                        class="w-full grid justify-items-start text-base md:text-base font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
                        <h2>
                            {{titleInfo}}
                        </h2>
                    </div>
                </div>
                <!-- Title -->
                <div class="flex flex-col w-full min-h-10">
                    <div class="flex flex-row w-full">

                    </div>
                    <div
                        class="grid justify-items-end w-full text-base md:text-base font-extrabold tracking-tight leading-7 sm:leading-10 truncate">
                        <h2 matTooltipPosition="below"
                            matTooltip="Balance:&nbsp;{{(customerBudget?customerBudget.balance:0)|number:'1.0-5'}}&nbsp;&nbsp;IRR&#13;Cedit:&nbsp;{{(customerBudget?customerBudget.credit:0)|number:'1.0-5'}}&nbsp;&nbsp;IRR"
                            matTooltipClass="whitespace-pre" *ngIf="!isLoading"
                            style="color: #1967d2;background-color: #e8f0fe;"
                            class="flex flex-row rounded-2xl px-4 text-base md:text-base font-extrabold tracking-tight leading-7 sm:leading-10">
                            <mat-icon class="mt-1.5 mr-1.5" svgIcon="mat_outline:credit_card"></mat-icon>
                            <p style="width: fit-content;" class=" block truncate">
                                {{(customerBudget?customerBudget.balance+customerBudget.credit:0)|number:'1.0-5'}}&nbsp;&nbsp;IRR
                            </p>
                        </h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->

    </div>


    <ng-container>
        <div class="flex-auto px-6 py-3" fuseScrollbar #scrollContainer id="scrollDiv">

            <form [formGroup]="frmPayment" class="flex rounded-b-md rounded-tr-md flex-col px-8 py-4 bg-card shadow">
                <div class="h-2">
                    <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
                </div>
                <ng-container>
                    <div>
                        <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript min-w-50">
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:search'"></mat-icon>
                            <input (keyup)="applyFilterOnCustomerOrders($event.target.value)" matInput
                                [autocomplete]="'off'" [placeholder]="'Search'">
                            <mat-icon matPostfix matTooltip="Advanced Search" class="cursor-pointer">
                                settings
                            </mat-icon>
                        </mat-form-field>
                    </div>
                    <div *ngIf="this.filteredCustomerOrders.length; else noOrders"
                        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 mt-3 sm:mt-3">

                        <ng-container *ngFor="let order of filteredCustomerOrders; trackBy: trackByFn">

                            <div
                                class="flex flex-col h-auto border-solid border shadow border-slate-300 rounded-2xl overflow-hidden bg-card">
                                <div class="flex flex-col p-6">
                                    <div class="mb-5 flex flex-row items-center justify-between">
                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <div class="grid justify-items-start w-full">
                                                <p style="width: fit-content;"
                                                    class="p-1 rounded block truncate text-white"
                                                    [ngClass]="order.statusColour">
                                                    {{order.statusDesc}}</p>
                                            </div>
                                        </ng-container>
                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <button class="p-0 w-2.5 min-w-min max-w-min" mat-flat-button
                                                (click)="$event.stopPropagation(); selectedInfoRow = order"
                                                [matMenuTriggerFor]="contextMenu">
                                                <mat-icon>more_vert</mat-icon>
                                            </button>
                                        </ng-container>
                                    </div>
                                    <div class="flex items-center justify-between">

                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <div class="flex flex-row w-full">
                                                <div
                                                    class="grid justify-items-start py-0.5 w-1/2 rounded-full text-sm font-bold">
                                                    Order
                                                </div>
                                                <div
                                                    class="flex flex-row py-0.5 w-1/2 rounded-full text-sm font-semibold">
                                                    <span class="w-1/2"></span>
                                                    <span (click)="openDetailDialog(order.orderId)"
                                                        class="grid cursor-pointer justify-items-start w-1/2">{{order.orderCode}}</span>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div class="flex items-center">
                                            <ng-container *ngIf="order.status === 1000046">
                                                <mat-icon class="icon-size-5 text-green-600"
                                                    [svgIcon]="'heroicons_solid:badge-check'"
                                                    [matTooltip]="'You completed this course at least once'">
                                                </mat-icon>
                                            </ng-container>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between mt-2 mb-1">
                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <div class="flex flex-row w-full items-start justify-center">
                                                <div
                                                    class="grid justify-items-start py-0.5 w-1/2 rounded-full text-sm font-bold">
                                                    Order Type
                                                </div>
                                                <div
                                                    class="flex flex-row py-0.5 w-1/2 rounded-full text-sm font-semibold">
                                                    <span class="w-1/2"></span>
                                                    <span
                                                        class="grid justify-items-start w-1/2">{{order.orderTypeName}}</span>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <div class="flex items-center justify-between mt-2 mb-1">
                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <div class="flex flex-row w-full items-start justify-center">
                                                <div
                                                    class="grid justify-items-start py-0.5 w-1/2 rounded-full text-sm font-bold">
                                                    Rows
                                                </div>
                                                <div
                                                    class="flex flex-row py-0.5 w-1/2 rounded-full text-sm font-semibold">
                                                    <span class="w-1/2"></span>
                                                    <span
                                                        class="grid justify-items-start w-1/2">{{order.rowQuantity}}</span>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <div class="flex items-center justify-between mt-2 mb-1">
                                        <ng-container>
                                            <!-- *ngIf="(order.category | fuseFindByKey:'slug':categories) as category" -->
                                            <div class="flex flex-row w-full items-start justify-center">
                                                <div
                                                    class="grid justify-items-start py-0.5 w-1/2 rounded-full text-sm font-bold">
                                                    Products
                                                </div>
                                                <div
                                                    class="flex flex-row py-0.5 w-1/2 rounded-full text-sm font-semibold">
                                                    <span class="w-1/2"></span>
                                                    <span
                                                        class="grid justify-items-start w-1/2">{{order.productQuantity}}</span>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <div class="w-full my-2 h-1 border-t-2"></div>

                                    <!-- <div class="flex items-center leading-5 text-md text-secondary">
                                                <mat-icon class="icon-size-5 text-hint"
                                                    [svgIcon]="'heroicons_solid:clock'"></mat-icon>
                                                <div class="ml-1.5">{{order.localChangeDate}}-{{order.localChangeTime}}
                                                </div>
                                            </div> -->
                                    <div class="flex items-center mt-2 leading-5 text-md text-secondary">
                                        <!--  <mat-icon svgIcon="mat_outline:payments"></mat-icon> -->
                                        <div class="flex flex-row w-full items-start justify-center">
                                            <div
                                                class="grid justify-items-start py-0.5 w-2/3 rounded-full text-sm font-bold">
                                                <span>Total</span>
                                            </div>
                                            <div class="flex flex-row py-0.5 w-1/3 rounded-full text-sm font-semibold">
                                                <span
                                                    class="grid justify-items-start w-full">{{order.total|number:'1.0-5'}}&nbsp;&nbsp;IRR</span>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="flex items-center mt-2 leading-5 text-md text-secondary">
                                        <!--  <mat-icon svgIcon="mat_outline:paid"></mat-icon> -->
                                        <div class="flex flex-row w-full items-start justify-center">
                                            <div
                                                class="grid justify-items-start py-0.5 w-2/3 rounded-full text-sm font-bold">
                                                <span>Paid</span>
                                            </div>
                                            <div class="flex flex-row py-0.5 w-1/3 rounded-full text-sm font-semibold">

                                                <span class="grid justify-items-start w-full">
                                                    {{order.paidAmount|number:'1.0-5'}}&nbsp;&nbsp;IRR</span>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="flex items-center mt-2 leading-5 text-md text-secondary">
                                        <!--  <mat-icon svgIcon="mat_outline:paid"></mat-icon> -->
                                        <div class="flex flex-row w-full items-start justify-center">
                                            <div
                                                class="grid justify-items-start py-0.5 w-2/3 rounded-full text-sm font-bold">
                                                <span class="cursor-pointer" (click)="setPriceInInput( (order.total -
                                                        order.paidAmount),order.orderId)">Remained</span>
                                            </div>
                                            <div class="flex flex-row py-0.5 w-1/3 rounded-full text-sm font-semibold">

                                                <span class="grid justify-items-start w-full">
                                                    {{(order.total -
                                                    order.paidAmount)|number:'1.0-5'}}&nbsp;&nbsp;IRR</span>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="flex items-center mt-2 leading-5 text-md text-secondary">
                                        <!--  <mat-icon svgIcon="mat_outline:paid"></mat-icon> -->
                                        <div class="flex flex-row w-full items-start justify-center">
                                            <div
                                                class="grid justify-items-start py-0.5 w-2/3 rounded-full text-sm font-bold">
                                                <span class="cursor-pointer" (click)="setPriceInInput((order.total * order.minPaymentRate -
                                                        order.paidAmount),order.orderId)">Minimum
                                                    Acceptable</span>
                                            </div>
                                            <div class="flex flex-row py-0.5 w-1/3 rounded-full text-sm font-semibold">
                                                <span *ngIf="order.status !== 1000046"
                                                    class="grid justify-items-start w-full">
                                                    {{(order.total * order.minPaymentRate -
                                                    order.paidAmount)|number:'1.0-5'}}&nbsp;&nbsp;IRR</span>
                                                <span *ngIf="order.status === 1000046"
                                                    class="grid justify-items-start w-full">
                                                    {{(order.total -
                                                    order.paidAmount)|number:'1.0-5'}}&nbsp;&nbsp;IRR</span>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="w-full flex items-center mt-2 leading-5 text-md text-secondary">
                                        <div class="w-full">
                                            <mat-form-field appearance="outline" class="w-full">
                                                <mat-label>Adjustment</mat-label>
                                                <input (keyup)="setPriceInInput($event.target.value,order.orderId)"
                                                    [autocomplete]="'off'" matInput value=""
                                                    [formControlName]="order.orderId" maxlength="50">
                                                <span matSuffix>IRR</span>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col w-full mt-auto">
                                    <div class="relative h-0.5">
                                        <div class="z-10 absolute inset-x-0 h-6 -mt-3"
                                            [matTooltip]="(order.paidAmount + getNewPaymentSet(order.orderId)) /  order.total | percent"
                                            [matTooltipPosition]="'above'" [matTooltipClass]="'-mb-0.5'"></div>
                                        <mat-progress-bar class="h-0.5"
                                            [value]="(100 * (order.paidAmount + getNewPaymentSet(order.orderId)) ) / order.total">
                                        </mat-progress-bar>
                                    </div>

                                    <div class="px-6 py-4 text-right bg-gray-50 dark:bg-transparent">
                                        <button class="cursor-pointer" mat-stroked-button
                                            (click)="clearAdjustment(order.orderId)">
                                            <span class="inline-flex items-center">
                                                Clear
                                            </span>
                                        </button>

                                    </div>
                                </div>

                            </div>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-template #noOrders>
                    <div
                        class="mt-3 sm:mt-3 flex flex-auto flex-col items-center justify-center bg-gray-100 dark:bg-transparent">
                        <mat-icon class="icon-size-20" [svgIcon]="'iconsmind:file_search'"></mat-icon>
                        <div class="mt-6 text-2xl font-semibold tracking-tight text-secondary">No orders found!
                        </div>
                    </div>
                </ng-template>
                <div class="w-full mt-12" style="display: flex; align-items: center; place-content: center">
                    <button class="ml-1 cursor-pointer" mat-flat-button color="primary" [disabled]="isLoading"
                        (click)="confirm()" matStepperNext>Confirm</button>
                </div>
                <div class="flex items-center flex-wrap content-center w-full py-2">
                    <div class="w-auto h-auto min-h-15 m-auto">
                        <fuse-alert *ngIf="_result.message" [appearance]="'soft'" [dismissible]=" true"
                            [dismissed]="true" [name]="'successMessage'" [type]="'success'">
                            <b>Result: </b> {{_result.message}}.
                        </fuse-alert>
                        <fuse-alert *ngIf="_result.message" [appearance]="'soft'" [dismissible]="true"
                            [dismissed]="true" [name]="'errorMessage'" [type]="'error'">
                            <b>Result: </b> {{_result.message}}.
                        </fuse-alert>
                    </div>
                </div>
            </form>

        </div>
    </ng-container>
</div>
<mat-menu #contextMenu="matMenu">
    <ng-template matMenuContent>
        <button (click)="paymentConfirmation(selectedInfoRow.orderId)" mat-menu-item>Payment Confirmation
        </button>
    </ng-template>
</mat-menu>
